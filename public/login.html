<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Login • Movidesk - Sistemas Internos</title>
  <link href="style.css" rel="stylesheet" />
  <style>
    :root {
      --bg: #0b1220;
      --panel: rgba(17,24,39,0.55);
      --panel-border: rgba(148,163,184,0.25);
      --text: #e5e7eb;
      --text-muted: #94a3b8;
      --input-bg: rgba(2,6,23,0.85);
      --input-border: rgba(148,163,184,0.25);
      --input-focus: #60a5fa;
      --btn: #2563eb;
      --btn-hover: #1d4ed8;
      --card-shadow: 0 20px 40px rgba(0,0,0,0.35);
      --card-glass: blur(8px);
    }
    @media (prefers-color-scheme: light) {
      :root {
        --bg: #f5f7fb;
        --panel: rgba(255,255,255,0.9);
        --panel-border: rgba(0,0,0,0.06);
        --text: #0f172a;
        --text-muted: #475569;
        --input-bg: #ffffff;
        --input-border: rgba(15,23,42,0.12);
        --input-focus: #1d4ed8;
        --btn: #2563eb;
        --btn-hover: #1d4ed8;
        --card-shadow: 0 14px 28px rgba(2,6,23,0.12);
        --card-glass: blur(6px);
      }
    }

    body.loginPage {
      min-height: 100vh;
      display:flex; align-items:center; justify-content:center;
      padding: 24px; background: var(--bg);
    }
    .loginWrap { width: 100%; max-width: 460px; margin: 0 auto; }
    .loginCard {
      background: var(--panel);
      backdrop-filter: var(--card-glass);
      border: 1px solid var(--panel-border);
      border-radius: 20px;
      padding: 28px 24px 24px;
      box-shadow: var(--card-shadow), inset 0 1px 0 rgba(255,255,255,0.05);
      transition: background .2s, border-color .2s, box-shadow .2s;
      position: relative;
    }
    .loginLogo { display:flex; align-items:center; justify-content:center; margin-bottom: 18px; }
    .loginCard label {
      display:block; font-weight:700; margin: 10px 0 8px;
      color: var(--text); letter-spacing:.2px;
    }
    /* Layout interno alinhado e em "bubble" */
    .fields { display:flex; flex-direction:column; gap:14px; margin-top: 6px; }
    .bubble {
      width:100%; padding:13px 16px; border-radius:16px; outline:none;
      border:1px solid var(--input-border);
      background: var(--input-bg); color: var(--text);
      transition: box-shadow .2s, border-color .2s, background .2s, transform .06s;
    }
    .bubble:focus { border-color: var(--input-focus); box-shadow: 0 0 0 4px color-mix(in oklab, var(--input-focus) 25%, transparent); background: color-mix(in oklab, var(--input-bg) 88%, #000); }
    .bubble:hover { transform: translateY(-1px); }
    .loginCard input:focus {
      border-color: var(--input-focus);
      box-shadow: 0 0 0 3px color-mix(in oklab, var(--input-focus) 30%, transparent);
      background: color-mix(in oklab, var(--input-bg) 85%, #000);
    }
    .loginActions { display:flex; align-items:center; justify-content:space-between; gap:12px; margin-top:18px; }
    .btn {
      padding:10px 18px; border:none; border-radius:12px;
      background: var(--btn); color:#fff; font-weight:700; cursor:pointer;
      box-shadow: 0 6px 16px color-mix(in oklab, var(--btn) 35%, transparent);
      transition: filter .15s, transform .05s, background .2s, box-shadow .2s;
    }
    .btn:hover { background: var(--btn-hover); filter: brightness(1.03); }
    .btn:active { transform: translateY(1px); }
    .btn.loading { opacity:.75; cursor:wait; box-shadow:none; }
    .muted { color: var(--text-muted); font-size:12px; }
    .appFooter { text-align:center; margin-top:18px; color: var(--text-muted); font-size:12px; }
  </style>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('loginForm');
      if (!form) return;
      const btn = form.querySelector('.btnPrimary');

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        btn.disabled = true; btn.classList.add('loading');
        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value;
        if (!username || !password) { alert('Informe usuário e senha'); btn.disabled=false; btn.classList.remove('loading'); return; }

        try {
          const res = await fetch('/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password })
          });
          const data = await res.json().catch(() => ({}));
          if (res.ok && data && data.success) {
            if (data.mustChangePassword) { window.location.href = '/password'; return; }
            window.location.href = '/dashboard';
            return;
          }
          alert((data && data.error) || 'Falha no login');
        } catch (err) {
          console.error('Falha no login:', err);
          alert('Erro de conexão com o servidor');
        } finally {
          btn.classList.remove('loading'); btn.disabled = false;
        }
      });
    });
  </script>
</head>
<body class="loginPage">
  <div class="loginWrap">
    <form id="loginForm" class="loginCard" autocomplete="on" onsubmit="return false">
      <div class="loginLogo">
        <img class="logoGradient" src="/logo-viasoft.png" alt="Viasoft" height="42" />
      </div>

      <div class="fields">
        <div>
          <label for="username">Usuário</label>
          <input id="username" class="bubble" name="username" required autofocus />
        </div>
        <div>
          <label for="password">Senha</label>
          <input id="password" class="bubble" name="password" type="password" required />
        </div>
      </div>

      <div class="loginActions">
        <button class="btn btnPrimary" type="submit">Entrar</button>
        <span class="muted">Dica: peça ao admin para criar seu acesso.</span>
      </div>
    </form>
    <div class="appFooter">Desenvolvido para Viasoft © 2025</div>
  </div>
</body>
</html>
